<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/view.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="git+https://github.com/pakastin/frzr.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation.js~Animation.html">Animation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/observable.js~Observable.html">Observable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/view.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/viewlist.js~ViewList.html">ViewList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-el">el</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prefix">prefix</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-raf">raf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-translate">translate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-each">each</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-eachCSS">eachCSS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extendable">extendable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isDefined">isDefined</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffle">shuffle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ease">ease</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ViewOptions">ViewOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ViewListOptions">ViewListOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/view.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
import { extendable } from &apos;./utils&apos;;
import { prefix } from &apos;./prefix&apos;;
import { Observable } from &apos;./observable&apos;;

const EVENT = &apos;init inited mount mounted unmount unmounted sort sorted update updated destroy&apos;.split(&apos; &apos;).reduce((obj, name) =&gt; {
  obj[name] = name;
  return obj;
}, {});

/**
 * VanillaJS helper for single DOM element
 */
export class View extends Observable {
  /**
   * @external {HTMLElement} https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement
   */

  /**
   * @typedef {Object} ViewOptions
   * @property {el|HTMLElement} [el=el(&apos;div&apos;)] DOM element
   * @property {Function} [init] &apos;init&apos; event handler shortcut
   * @property {Function} [inited] &apos;inited&apos; event handler shortcut
   * @property {Function} [mount] &apos;mount&apos; event handler shortcut
   * @property {Function} [mounted] &apos;mounted&apos; event handler shortcut
   * @property {Function} [sort] &apos;sort&apos; event handler shortcut
   * @property {Function} [sorted] &apos;sorted&apos; event handler shortcut
   * @property {Function} [update] &apos;update&apos; event handler shortcut
   * @property {Function} [updated] &apos;updated&apos; event handler shortcut
   * @property {Function} [destroy] &apos;destroy&apos; event handler shortcut
   * @property {*} [*] Anything else you want to pass on to View
   */

  /**
   * Creates View
   * @param  {ViewOptions} [options] View options
   * @param  {*} [data]    Any data to pass on to init()
   * @return {View}
   */

  constructor (options = {}, data) {
    super();

    /**
     * el attributes cache
     * @type {Object}
     */
    this.attrs = {};
    /**
     * el classNames cache
     * @type {Object}
     */
    this.classes = {};
    /**
     * HTMLElement
     * @type {el|HTMLElement}
     */
    this.el = null;
    /**
     * Proxy event listeners cache
     * @type {Array}
     */
    this.eventListeners = [];
    /**
     * el innerHTML cache
     * @type {String}
     */
    this.html = &apos;&apos;;
    /**
     * Listeners cache
     * @type {Object}
     */
    this.listeners = {};
    /**
     * el styles cache
     * @type {Object}
     */
    this.styles = {};
    /**
     * el textContent cache
     * @type {String}
     */
    this.text = &apos;&apos;;

    for (const key in options) {
      if (EVENT[key]) {
        this.on(key, options[key]);
      } else {
        this[key] = options[key];
      }
    }

    this.trigger(EVENT.init, data);
    if (!this.el) this.el = document.createElement(&apos;div&apos;);
    this.el.view = this;
    this.trigger(EVENT.inited, data);
  }
  /**
   * Sets/removes View element attribute (only if changed)
   * @param {String} attributeName   Attribute name
   * @param {*|null} value Attribute value or null to remove
   * @return {View}
   */
  setAttr (attributeName, value) {
    if (!this.attrs) this.attrs = {};

    if (this.attrs[attributeName] === value) {
      return this;
    }
    if (value || value === &apos;&apos;) {
      this.el.setAttribute(attributeName, value);
      this.attrs[attributeName] = value;
    } else {
      this.el.removeAttribute(attributeName);
      this.attrs[attributeName] = null;
    }

    return this;
  }
  /**
   * Sets/removes View element class (only if changed)
   * @param {String} className   Class name
   * @param {Boolean} value true / false
   * @return {View}
   */
  setClass (className, value) {
    if (!this.classes) this.classes = {};

    if (this.classes[className] === value) {
      return this;
    }
    if (value) {
      this.el.classList.add(className);
    } else {
      this.el.classList.remove(className);
    }
    this.classes[className] = value;

    return this;
  }
  /**
   * Sets/removes View element style (only if changed)
   * @param {String} propertyName   Style name
   * @param {*|null} value Style value or null to remove
   * @return {View}
   */
  setStyle (propertyName, value) {
    if (!this.styles) this.styles = {};

    if (this.styles[propertyName] === value) {
      return this;
    }

    const prefixed = prefix(propertyName);

    this.el.style[prefixed] = value;
    this.styles[propertyName] = value;

    return this;
  }
  /**
   * Sets View element textContent (only if changed)
   * @param {String} text Text to be applied to textContent
   * @return {View}
   */
  setText (text) {
    if (this.text === text) {
      return this;
    }
    this.el.textContent = text;
    this.text = text;

    return this;
  }
  /**
   * Sets View element innerHTML (only if changed)
   * @param {String} html HTML string
   * @return {View}
   */
  setHTML (html) {
    if (this.html === html) {
      return this;
    }
    this.el.innerHTML = html;
    this.html = html;

    return this;
  }
  /**
   * Adds proxy event listener to View
   * @param {[type]}   listenerName       Listener name
   * @param {Function} handler         Listener handler
   * @param {Boolean}   useCapture Use capture or not
   * @return {View}
   */
  addListener (listenerName, handler, useCapture) {
    const listener = {
      name: listenerName,
      handler,
      proxy: (...args) =&gt; {
        handler.apply(this, args);
      }
    };
    if (!this.eventListeners) this.eventListeners = [];

    this.eventListeners.push(listener);
    this.el.addEventListener(name, listener.proxy, useCapture);

    return this;
  }
  /**
   * Removes all proxy event listeners from View, or by name, or by name and handler
   * @param  {String}   [listenerName] Listener name
   * @param  {Function} [handler]   Listener handler
   * @return {View}
   */
  removeListener (listenerName, handler) {
    const listeners = this.eventListeners;
    if (!listeners) {
      return this;
    }
    if (typeof listenerName === &apos;undefined&apos;) {
      for (let i = 0; i &lt; listeners.length; i++) {
        this.el.removeEventListener(listeners[i].proxy);
      }
      this.listeners = [];
    } else if (typeof handler === &apos;undefined&apos;) {
      for (let i = 0; i &lt; listeners.length; i++) {
        if (listeners[i].name === listenerName) {
          listeners.splice(i--, 1);
        }
      }
    } else {
      for (let i = 0; i &lt; listeners.length; i++) {
        const listener = listeners[i];
        if (listener.name === listenerName &amp;&amp; handler === listener.handler) {
          listeners.splice(i--, 1);
        }
      }
    }

    return this;
  }
  /**
   * Adds child View/ViewList to View
   * @param {View|ViewList} child Child View/ViewList to be added
   * @return {View}
   */
  addChild (child) {
    if (child.views) {
      child.parent = this;
      return this.setChildren(...child.views);
    }
    let sorting = false;
    if (child.parent) {
      sorting = true;
      child.trigger(EVENT.sort);
    } else {
      child.trigger(EVENT.mount);
    }

    this.el.appendChild(child.el);
    child.parent = this;

    if (sorting) {
      child.trigger(EVENT.sorted);
    } else {
      child.trigger(EVENT.mounted);
    }

    return this;
  }
  /**
   * Adds child View before another View/HTMLElement
   * @param {View} child  Child View to be added
   * @param {View|HTMLElement} before Reference View/HTMLElement
   * @return {View}
   */
  addBefore (child, before) {
    let sorting = false;

    if (child.parent) {
      sorting = true;
      child.trigger(EVENT.sort);
    } else {
      child.trigger(EVENT.mount);
    }

    this.el.insertBefore(child.el, before.el || before);
    child.parent = this;

    if (sorting) {
      child.trigger(EVENT.sorted);
    } else {
      child.trigger(EVENT.mounted);
    }

    return this;
  }
  /**
   * Replace children with Views or ViewList
   * @param {...View|ViewList} views [description]
   * @return {View}
   */
  setChildren (...views) {
    if (views.length &amp;&amp; views[0].views) {
      views[0].parent = this;
      if (!views[0].views.length) {
        return this;
      }
      this.setChildren(...views[0].views);
    }
    let traverse = this.el.firstChild;

    for (let i = 0; i &lt; views.length; i++) {
      const view = views[i];

      if (traverse === view.el) {
        traverse = traverse.nextSibling;
        continue;
      }
      if (traverse) {
        this.addBefore(view, traverse);
      } else {
        this.addChild(view);
      }
    }
    while (traverse) {
      const next = traverse.nextSibling;

      if (traverse.view) {
        traverse.view.parent.removeChild(traverse.view);
      } else {
        this.el.removeChild(traverse);
      }

      traverse = next;
    }

    return this;
  }
  /**
   * Remove child View / ViewList
   * @param  {View|ViewList} child Child View/ViewList to be removed
   * @return {View}
   */
  removeChild (child) {
    if (!child.parent) {
      return this;
    }
    child.trigger(EVENT.unmount);

    this.el.removeChild(child.el);
    child.parent = null;

    child.trigger(EVENT.unmounted);

    return this;
  }
  /**
   * Trigger &apos;update&apos; with data
   * @param  {*} data Any data
   * @return {View}
   */
  update (data) {
    this.trigger(EVENT.update, data);
  }
  /**
   * Destroy View (remove listeners, children, etc..)
   */
  destroy () {
    this.trigger(EVENT.destroy);
    if (this.parent) this.parent.removeChild(this);

    let traverse = this.el.firstChild;

    while (traverse) {
      if (traverse.view) {
        traverse.view.destroy();
      } else {
        this.el.removeChild(traverse);
      }
      traverse = this.el.firstChild;
    }
    this.off();
    this.removeListener();
  }
}

extendable(View);
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
